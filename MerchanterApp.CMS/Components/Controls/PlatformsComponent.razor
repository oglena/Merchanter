@rendermode InteractiveServer
@using System.Text.Json.Serialization
@using Newtonsoft.Json
@using System.Text
@inject IHttpContextAccessor HttpContextAccessor
@inject IPostHelper PostHelper

<div class="container-fluid bg-rebeccapurple bg-gradient text-light rounded-2 p-3">
	<div class="row mt-3">
		<div class="col-12 ps-2">
			<h2>
				<i class="bi bi-boxes bi-lg"></i>&nbsp;Platforms
			</h2>
		</div>
	</div>
</div>

<div class="row mt-3 p-2">
	<AlertComponent page_message="@page_message" message_status="@message_status" />
	@if (platforms != null && platforms.Count > 0)
	{
		@if (string.IsNullOrWhiteSpace(selected_platform_name))
		{
			<div class="container-fluid">
				<div class="row row-cols-2 row-cols-sm-2 row-cols-md-2 row-cols-lg-3 row-cols-xl-3 row-cols-xxl-4">
					@foreach (var item in platforms.DistinctBy(x => x.name))
					{
						<div class="col mb-4">
							<div class="card text-center shadow" style='border-color:@(item.status ? "green" : "red");'>
								<img src="platform_logos/@(item.image)" class="card-img" alt="@item.name">
								<div class="card-body">
									<h3 class="card-title">@item.name</h3><hr />
									<p class="card-text p-2">
										<button type="button" class="btn btn-outline-dark btn-sm shadow" @onclick="() => OpenSettings(item)"><span><i class="bi bi-gear"></i>&nbsp;SETTINGS</span></button>
									</p>
								</div>
								<div class="card-footer">
									<small class="text-body">Platform Status: @(item.status == true ? "Active" : "Passive")</small>
									<small class="text-center"><span class="badge rounded-pill text-bg-secondary">Last Update:&nbsp;@item.update_date.ToString("dd.MM.yyyy")</span></small>
								</div>
							</div>
						</div>
					}
				</div>
			</div>
		}
		else
		{
			<div class="row mb-3">
				<a href="javascript:void(0);" @onclick="() => selected_platform_name = string.Empty" class="btn btn-outline-dark btn-sm shadow"><span><i class="bi bi-arrow-left"></i>&nbsp;Back to Platforms</span></a>
			</div>

			@if (selected_platform_name == Constants.ENTEGRA)
			{
				@if (settings != null && settings.entegra != null)
				{
					<div class="container-fluid">
						<div class="row">
							<div class="col-12 ps-2 py-2">
								<h2>
									@Constants.ENTEGRA&nbsp;Settings
								</h2>
							</div>
						</div>
						<div class="row">
							<EditForm Model="settings.entegra" class="container-fluid">
								<div class="col-12 p-3 bg-light rounded-3 border">
									<h5>
										Rest Api Credentials
									</h5>
									<div class="row mt-3">
										<div class="col-12 ps-2 mb-3">
											<div class="form-floating">
												<InputText type="text" class="form-control" DisplayName="api_url" @bind-Value="settings.entegra.api_url" />
												<label for="api_url" class="form-label">Api Url</label>
											</div>
										</div>
									</div>
									<div class="row mt-3">
										<div class="col-12 ps-2 mb-3">
											<div class="form-floating">
												<InputText type="text" class="form-control" DisplayName="api_username" @bind-Value="settings.entegra.api_username" />
												<label for="api_username" class="form-label">Api User Name</label>
											</div>
										</div>
									</div>
									<div class="row mt-3">
										<div class="col-12 ps-2 mb-3">
											<div class="form-floating">
												<InputText type="password" class="form-control" DisplayName="api_password" @bind-Value="settings.entegra.api_password" />
												<label for="api_password" class="form-label">Api Url</label>
											</div>
										</div>
									</div>
									<div class="row mt-3 bg-dark text-light rounded-2">
										<div class="col-12 pt-3 ps-2 mb-3">
											<button type="submit" class="btn btn-success shadow float-end" @onclick="@(() => SaveEntegraSettings(settings.entegra))" disabled="@(is_refreshing)"><i class="bi bi-floppy"></i>&nbsp;Save These Settings&nbsp;&nbsp;<span class='spinner-border spinner-border-sm border-1 @(is_refreshing ? "" : "d-none")' aria-hidden="true"></span></button>
											<button type="button" class="btn btn-primary shadow float-start" disabled="@(is_refreshing)"><i class="bi bi-arrows-angle-contract"></i>&nbsp;Test These Settings&nbsp;&nbsp;<span class='spinner-border spinner-border-sm border-1 @(is_refreshing ? "" : "d-none")' aria-hidden="true"></span></button><br /><br />
											<small class="float-start">Warning: This action will test the connection to the Entegra Api.</small>
										</div>
									</div>
								</div>
							</EditForm>
						</div>
					</div>
				}
				else
				{
					<h2>Settings Not Registered</h2>
				}
			}

			@if (selected_platform_name == Constants.NETSIS)
			{
				@if (settings != null && settings.netsis != null)
				{
					<div class="container-fluid">
						<div class="row">
							<div class="col-12 ps-2">
								<h2>
									@Constants.NETSIS&nbsp;Settings
								</h2>
							</div>
						</div>
						<div class="row">
							<EditForm Model="settings.settings" class="container-fluid">
								<div class="col-12 p-3 bg-light rounded-3 border">
									<h5>
										Rest Api Credentials
									</h5>
									<div class="row mt-3">
										<div class="col-12 ps-2 mb-3">
											<div class="form-floating">
												<InputText type="text" class="form-control" DisplayName="rest_url" @bind-Value="settings.netsis.rest_url" />
												<label for="rest_url" class="form-label">Rest Url</label>
											</div>
										</div>
									</div>
									<div class="row mt-3">
										<div class="col-12 ps-2 mb-3">
											<div class="form-floating">
												<InputText type="text" class="form-control" DisplayName="netopenx_user" @bind-Value="settings.netsis.netopenx_user" />
												<label for="netopenx_user" class="form-label">Api User Name</label>
											</div>
										</div>
									</div>
									<div class="row mt-3">
										<div class="col-12 ps-2 mb-3">
											<div class="form-floating">
												<InputText type="password" class="form-control" DisplayName="netopenx_password" @bind-Value="settings.netsis.netopenx_password" />
												<label for="netopenx_password" class="form-label">Api Password</label>
											</div>
										</div>
									</div>
									<div class="row mt-3">
										<div class="col-12 ps-2 mb-3">
											<div class="form-floating">
												<InputText type="password" class="form-control" DisplayName="dbname" @bind-Value="settings.netsis.dbname" />
												<label for="dbname" class="form-label">Netsis DB Name</label>
											</div>
										</div>
									</div>
									<div class="row mt-3">
										<div class="col-12 ps-2 mb-3">
											<div class="form-floating">
												<InputText type="password" class="form-control" DisplayName="dbuser" @bind-Value="settings.netsis.dbuser" />
												<label for="dbuser" class="form-label">Netsis DB User</label>
											</div>
										</div>
									</div>
									<div class="row mt-3">
										<div class="col-12 ps-2 mb-3">
											<div class="form-floating">
												<InputText type="password" class="form-control" DisplayName="dbpassword" @bind-Value="settings.netsis.dbpassword" />
												<label for="dbpassword" class="form-label">Netsis DB Password</label>
											</div>
										</div>
									</div>
									<div class="row mt-3 bg-dark text-light rounded-2">
										<div class="col-12 pt-3 ps-2 mb-3">
											<button type="button" class="btn btn-primary shadow float-start" disabled="@(is_refreshing)"><i class="bi bi-arrows-angle-contract"></i>&nbsp;Test These Settings&nbsp;&nbsp;<span class='spinner-border spinner-border-sm border-1 @(is_refreshing ? "" : "d-none")' aria-hidden="true"></span></button><br /><br />
											<small class="float-start">Warning: This action will test the connection to the Netsis Api.</small>
										</div>
									</div>
								</div>
								<div class="row mt-3">
									<div class="col-12 ps-2 mb-3">
										<div class="form-floating">
											<InputText type="text" class="form-control" DisplayName="belgeonek_musterisiparisi" @bind-Value="settings.netsis.belgeonek_musterisiparisi" />
											<label for="belgeonek_musterisiparisi" class="form-label">belgeonek_musterisiparisi</label>
										</div>
									</div>
								</div>
								<div class="row mt-3">
									<div class="col-12 ps-2 mb-3">
										<div class="form-floating">
											<InputText type="text" class="form-control" DisplayName="siparis_carionek" @bind-Value="settings.netsis.siparis_carionek" />
											<label for="siparis_carionek" class="form-label">siparis_carionek</label>
										</div>
									</div>
								</div>
								<div class="row mt-3">
									<div class="col-12 ps-2 mb-3">
										<div class="form-floating">
											<InputText type="text" class="form-control" DisplayName="cari_siparis_grupkodu" @bind-Value="settings.netsis.cari_siparis_grupkodu" />
											<label for="cari_siparis_grupkodu" class="form-label">cari_siparis_grupkodu</label>
										</div>
									</div>
								</div>
								<div class="row mt-3">
									<div class="col-12 ps-2 mb-3">
										<div class="form-floating">
											<InputText type="text" class="form-control" DisplayName="sipari_caritip" @bind-Value="settings.netsis.sipari_caritip" />
											<label for="sipari_caritip" class="form-label">sipari_caritip</label>
										</div>
									</div>
								</div>
								<div class="row mt-3">
									<div class="col-12 ps-2 mb-3">
										<div class="form-floating">
											<InputText type="text" class="form-control" DisplayName="siparis_muhasebekodu" @bind-Value="settings.netsis.siparis_muhasebekodu" />
											<label for="siparis_muhasebekodu" class="form-label">siparis_muhasebekodu</label>
										</div>
									</div>
								</div>
								<div class="row mt-3">
									<div class="col-12 ps-2 mb-3">
										<div class="form-floating">
											<InputNumber type="text" class="form-control" DisplayName="siparis_subekodu" @bind-Value="settings.netsis.siparis_subekodu" />
											<label for="siparis_subekodu" class="form-label">siparis_subekodu</label>
										</div>
									</div>
								</div>
								<div class="row mt-3">
									<div class="col-12 ps-2 mb-3">
										<div class="form-floating">
											<InputNumber type="text" class="form-control" DisplayName="siparis_depokodu" @bind-Value="settings.netsis.siparis_depokodu" />
											<label for="siparis_depokodu" class="form-label">siparis_depokodu</label>
										</div>
									</div>
								</div>
								<div class="row mt-3">
									<div class="col-12 ps-2 mb-3">
										<div class="form-floating">
											<InputText type="text" class="form-control" DisplayName="ebelge_dizayn_earsiv" @bind-Value="settings.netsis.ebelge_dizayn_earsiv" />
											<label for="ebelge_dizayn_earsiv" class="form-label">ebelge_dizayn_earsiv</label>
										</div>
									</div>
								</div>
								<div class="row mt-3">
									<div class="col-12 ps-2 mb-3">
										<div class="form-floating">
											<InputText type="text" class="form-control" DisplayName="ebelge_dizayn_efatura" @bind-Value="settings.netsis.ebelge_dizayn_efatura" />
											<label for="ebelge_dizayn_efatura" class="form-label">ebelge_dizayn_efatura</label>
										</div>
									</div>
								</div>
								<div class="row mt-3">
									<div class="col-12 ps-2 mb-3">
										<div class="form-floating">
											<InputText type="text" class="form-control" DisplayName="ebelge_klasorismi" @bind-Value="settings.netsis.ebelge_klasorismi" />
											<label for="ebelge_klasorismi" class="form-label">ebelge_klasorismi</label>
										</div>
									</div>
								</div>
								<div class="row mt-3">
									<div class="col-12 ps-2 mb-3">
										<div class="form-floating">
											<InputText type="text" class="form-control" DisplayName="efatura_belge_onek" @bind-Value="settings.netsis.efatura_belge_onek" />
											<label for="efatura_belge_onek" class="form-label">efatura_belge_onek</label>
										</div>
									</div>
								</div>
								<div class="row mt-3">
									<div class="col-12 ps-2 mb-3">
										<div class="form-floating">
											<InputText type="text" class="form-control" DisplayName="earsiv_belge_onek" @bind-Value="settings.netsis.earsiv_belge_onek" />
											<label for="earsiv_belge_onek" class="form-label">earsiv_belge_onek</label>
										</div>
									</div>
								</div>
								<div class="row mt-3">
									<div class="col-12 ps-2 mb-3">
										<div class="form-floating">
											<InputText type="text" class="form-control" DisplayName="fatura_cari_gruplari" @bind-Value="settings.netsis.fatura_cari_gruplari" />
											<label for="fatura_cari_gruplari" class="form-label">fatura_cari_gruplari</label>
										</div>
									</div>
								</div>
								<div class="row mt-3">
									<div class="col-12 ps-2 mb-3">
										<div class="form-floating">
											<InputText type="text" class="form-control" DisplayName="siparis_kod2" @bind-Value="settings.netsis.siparis_kod2" />
											<label for="siparis_kod2" class="form-label">siparis_kod2</label>
										</div>
									</div>
								</div>
								<div class="row mt-3">
									<div class="col-12 ps-2 mb-3">
										<div class="form-floating">
											<InputText type="text" class="form-control" DisplayName="siparis_cyedek1" @bind-Value="settings.netsis.siparis_cyedek1" />
											<label for="siparis_cyedek1" class="form-label">siparis_cyedek1</label>
										</div>
									</div>
								</div>
								<div class="row mt-3">
									<div class="col-12 ps-2 mb-3">
										<div class="form-floating">
											<InputText type="text" class="form-control" DisplayName="siparis_ekack15" @bind-Value="settings.netsis.siparis_ekack15" />
											<label for="siparis_ekack15" class="form-label">siparis_ekack15</label>
										</div>
									</div>
								</div>
								<div class="row mt-3">
									<div class="col-12 ps-2 mb-3">
										<div class="form-floating">
											<InputText type="text" class="form-control" DisplayName="siparis_ekack10" @bind-Value="settings.netsis.siparis_ekack10" />
											<label for="siparis_ekack10" class="form-label">siparis_ekack10</label>
										</div>
									</div>
								</div>
								<div class="row mt-3">
									<div class="col-12 ps-2 mb-3">
										<div class="form-floating">
											<InputText type="text" class="form-control" DisplayName="siparis_ekack11" @bind-Value="settings.netsis.siparis_ekack11" />
											<label for="siparis_ekack11" class="form-label">siparis_ekack11</label>
										</div>
									</div>
								</div>
								<div class="row mt-3">
									<div class="col-12 ps-2 mb-3">
										<div class="form-floating">
											<InputText type="text" class="form-control" DisplayName="siparis_ekack4" @bind-Value="settings.netsis.siparis_ekack4" />
											<label for="siparis_ekack4" class="form-label">siparis_ekack4</label>
										</div>
									</div>
								</div>
								<div class="row mt-3 bg-light rounded-2">
									<div class="col-12 pt-3 ps-2 mb-3">
										<button type="submit" class="btn btn-success shadow float-end" @onclick="@(() => SaveNetsisSettings(settings.netsis))" disabled="@(is_refreshing)"><i class="bi bi-floppy"></i>&nbsp;Save These Settings&nbsp;&nbsp;<span class='spinner-border spinner-border-sm border-1 @(is_refreshing ? "" : "d-none")' aria-hidden="true"></span></button>
									</div>
								</div>
							</EditForm>
						</div>
					</div>
				}
				else
				{
					<h2>Settings Not Registered</h2>
				}
			}

			@if (selected_platform_name == Constants.MAGENTO2)
			{
				@if (settings != null && settings.magento != null)
				{
					<div class="container-fluid">
						<div class="row">
							<div class="col-12 ps-2 py-2">
								<h2>
									@Constants.MAGENTO2&nbsp;Settings
								</h2>
							</div>
						</div>
						<div class="row">
							<EditForm Model="settings.magento" class="container-fluid">
								<div class="col-12 p-3 bg-light rounded-3 border">
									<h5>
										Rest Api Credentials
									</h5>
									<div class="row mt-3">
										<div class="col-12 ps-2 mb-3">
											<div class="form-floating">
												<InputText type="text" class="form-control" DisplayName="base_url" @bind-Value="settings.magento.base_url" />
												<label for="base_url" class="form-label">Base Url</label>
											</div>
										</div>
									</div>
									<div class="row mt-3">
										<div class="col-12 ps-2 mb-3">
											<div class="form-floating">
												<InputText type="password" class="form-control" DisplayName="token" @bind-Value="settings.magento.token" />
												<label for="token" class="form-label">Api Token</label>
											</div>
										</div>
									</div>
									<div class="row mt-3 bg-dark text-light rounded-2">
										<div class="col-12 pt-3 ps-2 mb-3">
											<button type="button" class="btn btn-primary shadow float-start" disabled="@(is_refreshing)"><i class="bi bi-arrows-angle-contract"></i>&nbsp;Test These Settings&nbsp;&nbsp;<span class='spinner-border spinner-border-sm border-1 @(is_refreshing ? "" : "d-none")' aria-hidden="true"></span></button><br /><br />
											<small class="float-start">Warning: This action will test the connection to the Magento2 Api.</small>
										</div>
									</div>
								</div>
								<div class="row mt-3">
									<div class="col-12 ps-2 mb-3">
										<div class="form-floating">
											<InputNumber type="text" class="form-control" DisplayName="root_category_id" @bind-Value="settings.magento.root_category_id" />
											<label for="root_category_id" class="form-label">Magento Root Category ID</label>
										</div>
									</div>
								</div>
								<div class="row mt-3">
									<div class="col-12 ps-2 mb-3">
										<div class="form-floating">
											<InputText type="text" class="form-control" DisplayName="order_processing_comment" @bind-Value="settings.magento.order_processing_comment" />
											<label for="order_processing_comment" class="form-label">Order Processing Comment</label>
										</div>
									</div>
								</div>
								<div class="row mt-3">
									<div class="col-12 ps-2 mb-3">
										<div class="form-floating">
											<InputText type="text" class="form-control" DisplayName="barcode_attribute_code" @bind-Value="settings.magento.barcode_attribute_code" />
											<label for="barcode_attribute_code" class="form-label">Barcode Attribute Code</label>
										</div>
									</div>
								</div>
								<div class="row mt-3">
									<div class="col-12 ps-2 mb-3">
										<div class="form-floating">
											<InputText type="text" class="form-control" DisplayName="brand_attribute_code" @bind-Value="settings.magento.brand_attribute_code" />
											<label for="brand_attribute_code" class="form-label">Brand Attribute Code</label>
										</div>
									</div>
								</div>
								<div class="row mt-3">
									<div class="col-12 ps-2 mb-3">
										<div class="form-floating">
											<InputText type="text" class="form-control" DisplayName="is_xml_enabled_attribute_code" @bind-Value="settings.magento.is_xml_enabled_attribute_code" />
											<label for="is_xml_enabled_attribute_code" class="form-label">XML Enabled Attribute Code</label>
										</div>
									</div>
								</div>
								<div class="row mt-3">
									<div class="col-12 ps-2 mb-3">
										<div class="form-floating">
											<InputText type="text" class="form-control" DisplayName="xml_sources_attribute_code" @bind-Value="settings.magento.xml_sources_attribute_code" />
											<label for="xml_sources_attribute_code" class="form-label">XML Sources Attribute Code</label>
										</div>
									</div>
								</div>
								<div class="row mt-3">
									<div class="col-12 ps-2 mb-3">
										<div class="form-floating">
											<InputText type="text" class="form-control" DisplayName="customer_tc_no_attribute_code" @bind-Value="settings.magento.customer_tc_no_attribute_code" />
											<label for="customer_tc_no_attribute_code" class="form-label">Identity Number Attribute Code</label>
										</div>
									</div>
								</div>
								<div class="row mt-3">
									<div class="col-12 ps-2 mb-3">
										<div class="form-floating">
											<InputText type="text" class="form-control" DisplayName="customer_firma_ismi_attribute_code" @bind-Value="settings.magento.customer_firma_ismi_attribute_code" />
											<label for="customer_firma_ismi_attribute_code" class="form-label">Customer Corporate Name Attribute Code</label>
										</div>
									</div>
								</div>
								<div class="row mt-3">
									<div class="col-12 ps-2 mb-3">
										<div class="form-floating">
											<InputText type="text" class="form-control" DisplayName="customer_firma_vergidairesi_attribute_code" @bind-Value="settings.magento.customer_firma_vergidairesi_attribute_code" />
											<label for="customer_firma_vergidairesi_attribute_code" class="form-label">Customer Corporate Tax Region Attribute Code</label>
										</div>
									</div>
								</div>
								<div class="row mt-3">
									<div class="col-12 ps-2 mb-3">
										<div class="form-floating">
											<InputText type="text" class="form-control" DisplayName="customer_firma_vergino_attribute_code" @bind-Value="settings.magento.customer_firma_vergino_attribute_code" />
											<label for="customer_firma_vergino_attribute_code" class="form-label">Customer Corporate Tax Number Attribute Code</label>
										</div>
									</div>
								</div>
								<div class="row mt-3 bg-light rounded-2">
									<div class="col-12 pt-3 ps-2 mb-3">
										<button type="submit" class="btn btn-success shadow float-end" @onclick="@(() => SaveMagentoSettings(settings.magento))" disabled="@(is_refreshing)"><i class="bi bi-floppy"></i>&nbsp;Save These Settings&nbsp;&nbsp;<span class='spinner-border spinner-border-sm border-1 @(is_refreshing ? "" : "d-none")' aria-hidden="true"></span></button>
									</div>
								</div>
							</EditForm>
						</div>
					</div>
				}
				else
				{
					<h2>Settings Not Registered</h2>
				}
			}

			@* //TODO: These settings will split into different settings *@
			@if (selected_platform_name == Constants.YURTICI || selected_platform_name == Constants.MNG || selected_platform_name == Constants.ARAS)
			{
				@if (settings != null && settings.shipment != null)
				{
					<div class="container-fluid">
						<div class="row">
							<div class="col-12 ps-2">
								<h2>
									Shipment&nbsp;Settings
								</h2>
							</div>
						</div>
						<div class="row">
							<EditForm Model="settings.shipment" class="container-fluid">
								<ul class="nav nav-tabs" role="tablist">
									<li class="nav-item" role="presentation">
										<a class="nav-link @(selected_platform_name == Constants.YURTICI ? "active" : "")" id="tab-yurtici" data-bs-toggle="tab" href="#tab-yurtici-panel" role="tab" aria-controls="tab-yurtici-panel" aria-selected="true">Yurtiçi Kargo</a>
									</li>
									<li class="nav-item" role="presentation">
										<a class="nav-link @(selected_platform_name == Constants.MNG ? "active" : "")" id="tab-mng" data-bs-toggle="tab" href="#tab-mng-panel" role="tab" aria-controls="tab-mng-panel" aria-selected="false">MNG Kargo</a>
									</li>
									<li class="nav-item" role="presentation">
										<a class="nav-link @(selected_platform_name == Constants.ARAS ? "active" : "")" id="tab-aras" data-bs-toggle="tab" href="#tab-aras-panel" role="tab" aria-controls="tab-aras-panel" aria-selected="false">Aras Kargo</a>
									</li>
								</ul>
								<div class="tab-content">
									<div class="tab-pane mt-2 @(selected_platform_name == Constants.YURTICI ? "active" : "")" id="tab-yurtici-panel" role="tabpanel" aria-labelledby="tab-yurtici">
										<h5>
											Api Credentials
										</h5>
										<div class="row mt-3">
											<div class="form-check form-switch mt-2 ms-3">
												<InputCheckbox type="checkbox" class="form-check-input" role="switch" @bind-Value="settings.shipment.yurtici_kargo"></InputCheckbox>
												<label class="form-check-label">&nbsp;Yurtici Kargo Active ?</label>
											</div>
										</div>
										<div class="row mt-3">
											<div class="col-12 ps-2 mb-3">
												<div class="form-floating">
													<InputText type="text" class="form-control" DisplayName="yurtici_kargo_user_name" @bind-Value="settings.shipment.yurtici_kargo_user_name" />
													<label for="yurtici_kargo_user_name" class="form-label">Yurtici Kargo User Name</label>
												</div>
											</div>
										</div>
										<div class="row mt-3">
											<div class="col-12 ps-2 mb-3">
												<div class="form-floating">
													<InputText type="password" class="form-control" DisplayName="yurtici_kargo_password" @bind-Value="settings.shipment.yurtici_kargo_password" />
													<label for="yurtici_kargo_password" class="form-label">Yurtici Kargo Password</label>
												</div>
											</div>
										</div>
									</div>
									<div class="tab-pane @(selected_platform_name == Constants.MNG ? "active" : "")" id="tab-mng-panel" role="tabpanel" aria-labelledby="tab-mng">
										<div class="row mt-3">
											<div class="form-check form-switch mt-2 ms-3">
												<InputCheckbox type="checkbox" class="form-check-input" role="switch" @bind-Value="settings.shipment.mng_kargo"></InputCheckbox>
												<label class="form-check-label">&nbsp;MNG Kargo Active ?</label>
											</div>
										</div>
									</div>
									<div class="tab-pane @(selected_platform_name == Constants.ARAS ? "active" : "")" id="tab-aras-panel" role="tabpanel" aria-labelledby="tab-aras">
										<div class="row mt-3">
											<div class="form-check form-switch mt-2 ms-3">
												<InputCheckbox type="checkbox" class="form-check-input" role="switch" @bind-Value="settings.shipment.aras_kargo"></InputCheckbox>
												<label class="form-check-label">&nbsp;Aras Kargo Active ?</label>
											</div>
										</div>
									</div>
								</div>
								<div class="row mt-3 bg-dark text-light rounded-2">
									<div class="col-12 pt-3 ps-2 mb-3">
										<button type="submit" class="btn btn-success shadow float-end" @onclick="@(() => SaveShipmentSettings(settings.shipment))" disabled="@(is_refreshing)"><i class="bi bi-floppy"></i>&nbsp;Save These Settings&nbsp;&nbsp;<span class='spinner-border spinner-border-sm border-1 border-1 @(is_refreshing ? "" : "d-none")' aria-hidden="true"></span></button>
										<button type="button" class="btn btn-primary shadow float-start" disabled="@(is_refreshing)"><i class="bi bi-arrows-angle-contract"></i>&nbsp;Test These Settings&nbsp;&nbsp;<span class='spinner-border spinner-border-sm border-1 @(is_refreshing ? "" : "d-none")' aria-hidden="true"></span></button><br /><br />
										<small class="float-start">Warning: This action will test the connection to the Shipping Api's.</small>
									</div>
								</div>
							</EditForm>
						</div>
					</div>
				}
				else
				{
					<h2>Settings Not Registered</h2>
				}
			}

			@if (selected_platform_name == Constants.MERCHANTER)
			{
				<h2 class="text-danger">Under Construction</h2>
			}

			@if (selected_platform_name == Constants.PENTA || selected_platform_name == Constants.KOYUNCU || selected_platform_name == Constants.BOGAZICI || selected_platform_name == Constants.OKSID || selected_platform_name == Constants.FSP)
			{
				<h2 class="text-danger">Under Construction</h2>
			}

			<div class="row mt-3">
				<a href="javascript:void(0);" @onclick="() => selected_platform_name = string.Empty" class="btn btn-outline-dark btn-sm shadow"><span><i class="bi bi-arrow-left"></i>&nbsp;Back to Platforms</span></a>
			</div>
		}
	}
</div>

@code {
	[Parameter]
	public string? CID { get; set; }
	private bool is_refreshing = false;
	private string loading = "Loading...";
	private string page_message = "Platforms Loading...";
	private string message_status = "dark";
	Customer? customer { get; set; }
	SettingsMerchanter? settings { get; set; }
	List<Platform>? platforms { get; set; } = null;
	private string selected_platform_name { get; set; } = string.Empty;

	protected override async Task OnAfterRenderAsync(bool firstRender)
	{
		if (firstRender)
		{
			int customer_id = 0;
			if (!string.IsNullOrWhiteSpace(CID) && int.TryParse(CID, out customer_id))
			{
				//await LoadCustomer(customer_id);
				await LoadCustomerSettings(customer_id);
				await Task.Run(() =>
				{
					platforms = Platform.Dummies();
					page_message = string.Empty;
				});
				StateHasChanged();
			}
		}
	}

	private void OpenSettings(Platform item)
	{
		selected_platform_name = item.name;
		StateHasChanged();
	}

	public async Task LoadCustomerSettings(int _customer_id)
	{
		if (_customer_id > 0)
		{
			var response = await PostHelper.Request<SettingsMerchanter>(HttpContextAccessor?.HttpContext?.User?.FindFirst(Variables.auth_token)?.Value,
				Classes.PostHelper.PostMethod.Get,
				"api/Settings/" + _customer_id.ToString() + "/GetCustomerSettings");

			if (response != null && response.Success && response.Data != null)
			{
				settings = response.Data;
				page_message = string.Empty;
				StateHasChanged();
			}
			else
			{
				page_message = "Merchanter Server ServiceAPI data response empty.";
			}
		}
	}

	public async Task LoadCustomer(int _customer_id)
	{
		if (_customer_id > 0)
		{
			customer = null;
			var response = await PostHelper.Request<Customer>(HttpContextAccessor?.HttpContext?.User?.FindFirst(Variables.auth_token)?.Value,
				Classes.PostHelper.PostMethod.Get,
				"api/Customer/" + _customer_id.ToString() + "/GetCustomer");

			if (response != null && response.Success && response.Data != null)
			{
				customer = response.Data;
				StateHasChanged();
			}
			else
			{
				page_message = "Merchanter Server ServiceAPI data response empty.";
			}
		}
	}

	public async Task SaveGeneralSettings(SettingsGeneral _settings)
	{
		if (settings != null && int.TryParse(CID, out int customer_id))
		{
			int.TryParse(HttpContextAccessor?.HttpContext?.User?.FindFirst(Variables.admin_id)?.Value, out int admin_id);
			if (admin_id > 0)
			{
				is_refreshing = true;
				string json = JsonConvert.SerializeObject(_settings);
				var response = await PostHelper.Request<SettingsGeneral>(HttpContextAccessor?.HttpContext?.User?.FindFirst(Variables.auth_token)?.Value,
					Classes.PostHelper.PostMethod.Put,
					"api/Settings/" + CID + "/SaveGeneralSettings",
					new StringContent(json, Encoding.UTF8, "application/json"));

				if (response != null && response.Success && response.Data != null)
				{
					settings.settings = response.Data;
					page_message = "General settings saved. [" + DateTime.Now.ToString() + "]";
					message_status = "success";
				}
				else
				{
					page_message = "General settings save failed. [" + DateTime.Now.ToString() + "]";
					message_status = "danger";
				}
				is_refreshing = false;
			}
		}
	}

	public async Task SaveEntegraSettings(SettingsEntegra _settings)
	{
		if (settings != null && int.TryParse(CID, out int customer_id))
		{
			int.TryParse(HttpContextAccessor?.HttpContext?.User?.FindFirst(Variables.admin_id)?.Value, out int admin_id);
			if (admin_id > 0)
			{
				is_refreshing = true;
				string json = JsonConvert.SerializeObject(_settings);
				var response = await PostHelper.Request<SettingsEntegra>(HttpContextAccessor?.HttpContext?.User?.FindFirst(Variables.auth_token)?.Value,
					Classes.PostHelper.PostMethod.Put,
					"api/Settings/" + CID + "/SaveEntegraSettings",
					new StringContent(json, Encoding.UTF8, "application/json"));

				if (response != null && response.Success && response.Data != null)
				{
					settings.entegra = response.Data;
					page_message = "Entegra settings saved. [" + DateTime.Now.ToString() + "]";
					message_status = "success";
				}
				else
				{
					page_message = "Entegra settings save failed. [" + DateTime.Now.ToString() + "]";
					message_status = "danger";
				}
				is_refreshing = false;
			}
		}
	}

	public async Task SaveMagentoSettings(SettingsMagento _settings)
	{
		if (settings != null && int.TryParse(CID, out int customer_id))
		{
			int.TryParse(HttpContextAccessor?.HttpContext?.User?.FindFirst(Variables.admin_id)?.Value, out int admin_id);
			if (admin_id > 0)
			{
				is_refreshing = true;
				string json = JsonConvert.SerializeObject(_settings);
				var response = await PostHelper.Request<SettingsMagento>(HttpContextAccessor?.HttpContext?.User?.FindFirst(Variables.auth_token)?.Value,
					Classes.PostHelper.PostMethod.Put,
					"api/Settings/" + CID + "/SaveMagentoSettings",
					new StringContent(json, Encoding.UTF8, "application/json"));

				if (response != null && response.Success && response.Data != null)
				{
					settings.magento = response.Data;
					page_message = "Magento settings saved. [" + DateTime.Now.ToString() + "]";
					message_status = "success";
				}
				else
				{
					page_message = "Magento settings save failed. [" + DateTime.Now.ToString() + "]";
					message_status = "danger";
				}
				is_refreshing = false;
			}
		}
	}

	public async Task SaveNetsisSettings(SettingsNetsis _settings)
	{
		if (settings != null && int.TryParse(CID, out int customer_id))
		{
			int.TryParse(HttpContextAccessor?.HttpContext?.User?.FindFirst(Variables.admin_id)?.Value, out int admin_id);
			if (admin_id > 0)
			{
				is_refreshing = true;
				string json = JsonConvert.SerializeObject(_settings);
				var response = await PostHelper.Request<SettingsNetsis>(HttpContextAccessor?.HttpContext?.User?.FindFirst(Variables.auth_token)?.Value,
					Classes.PostHelper.PostMethod.Put,
					"api/Settings/" + CID + "/SaveNetsisSettings",
					new StringContent(json, Encoding.UTF8, "application/json"));

				if (response != null && response.Success && response.Data != null)
				{
					settings.netsis = response.Data;
					page_message = "Netsis settings saved. [" + DateTime.Now.ToString() + "]";
					message_status = "success";
				}
				else
				{
					page_message = "Netsis settings save failed. [" + DateTime.Now.ToString() + "]";
					message_status = "danger";
				}
				is_refreshing = false;
			}
		}
	}

	public async Task SaveShipmentSettings(SettingsShipment _settings)
	{
		if (settings != null && int.TryParse(CID, out int customer_id))
		{
			int.TryParse(HttpContextAccessor?.HttpContext?.User?.FindFirst(Variables.admin_id)?.Value, out int admin_id);
			if (admin_id > 0)
			{
				is_refreshing = true;
				string json = JsonConvert.SerializeObject(_settings);
				var response = await PostHelper.Request<SettingsShipment>(HttpContextAccessor?.HttpContext?.User?.FindFirst(Variables.auth_token)?.Value,
					Classes.PostHelper.PostMethod.Put,
					"api/Settings/" + CID + "/SaveShipmentSettings",
					new StringContent(json, Encoding.UTF8, "application/json"));
				if (response != null && response.Success && response.Data != null)
				{
					settings.shipment = response.Data;
					page_message = "Shipment settings saved. [" + DateTime.Now.ToString() + "]";
					message_status = "success";
				}
				else
				{
					page_message = "Shipment settings save failed. [" + DateTime.Now.ToString() + "]";
					message_status = "danger";
				}
				is_refreshing = false;
			}
		}
	}
}
