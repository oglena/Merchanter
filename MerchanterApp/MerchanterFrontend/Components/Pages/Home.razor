@attribute [Authorize]
@page "/"
@inject IHttpContextAccessor HttpContextAccessor

<PageTitle>Giriş | Merchanter</PageTitle>
@if (HttpContextAccessor?.HttpContext?.User.Identity != null && HttpContextAccessor.HttpContext.User.Identity.IsAuthenticated) {
    <FluentLayout Orientation="Orientation.Vertical" Width="100%">
        @if (customer_id > 0) {
            <FluentGrid Justify="JustifyContent.Center">
                <FluentGridItem lg="4">
                    <ServerComponent @ref="ServerComponentRef" customer_id="@customer_id" />
                </FluentGridItem>
                <FluentGridItem lg="8">
                    <SyncStatusesComponent customer_id="@customer_id" OnRefresh="ServerComponentRef.Refresh" />
                </FluentGridItem>
            </FluentGrid>
        }
    </FluentLayout>
}
else {
    <FluentLabel>Ürün düzenleme sayfasına erişim izniniz yok.</FluentLabel>
}

@code {
    public int customer_id { get; set; } = 0;
    private ServerComponent? ServerComponentRef;

    protected override void OnInitialized() {
        if (int.TryParse(HttpContextAccessor.HttpContext?.User.Claims.FirstOrDefault(x => x.Type == Variables.customer_id)?.Value, out int CID)) {
            customer_id = CID;
        }
    }
}